---
type: Posts
title: ë‹¤êµ­ì–´ ì ìš©ì‹œ ë¼ìš°íŒ… ê´€ë ¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
description: i18n ì‘ì—… ì¤‘ ì–¸ì–´ ë³€ê²½ì‹œì— ìºì‹œë¡œ ì¸í•œ ë¼ìš°íŒ… ì˜¤ì‘ë™ ë¬¸ì œ í•´ê²°í•˜ê¸°
date: 2023-09-08
tags: i18n, trouble shooting
series: íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
featured: true
---

## ì–¸ì–´ ë³€ê²½ì‹œ ì¿ í‚¤ì™€ ë¼ìš°íŒ… ê²½ë¡œê°€ ë¶ˆì¼ì¹˜í•˜ëŠ” í˜„ìƒ í•´ê²°í•˜ê¸°

### í˜„ì¬ ë¯¸ë“¤ì›¨ì–´ êµ¬í˜„ ì‚¬í•­

```ts title="middleware.ts"
import { NextRequest, NextResponse } from 'next/server';
import acceptLanguage from 'accept-language';
import { fallbackLng, languages } from './i18n/settings';

acceptLanguage.languages(languages);

export const config = {
  matcher: [
    '/((?!api|_next/static|_next/image|images|fonts|videos|assets|favicon.ico|robots|sitemap|sw.js).*)',
  ],
};

const cookieName = 'i18next';

const getLanguageFromRequest = (req: NextRequest): string | null => {
  const language = req.cookies.has(cookieName)
    ? req.cookies.get(cookieName)?.value // 1
    : req.headers.get('Accept-Language'); // 2

  return acceptLanguage.get(language) || null;
};

export function middleware(req: NextRequest) {
  const language = getLanguageFromRequest(req) || fallbackLng; // 3
  const response = NextResponse.next();

  response.cookies.set(cookieName, language); // 4

  const languageInNextUrl = languages.find((loc) =>
    req.nextUrl.pathname.startsWith(`/${loc}`),
  );

  if (languageInNextUrl && language !== languageInNextUrl) {
    response.cookies.set(cookieName, languageInNextUrl);
  }

  // 5
  if (
    !languages.some((loc) => req.nextUrl.pathname.startsWith(`/${loc}`)) &&
    !req.nextUrl.pathname.startsWith('/_next')
  ) {
    return NextResponse.redirect(
      new URL(`/${language}${req.nextUrl.pathname}`, req.url),
    );
  }
}
```

1. '/' ë¡œ ì ‘ê·¼ì‹œ íŠ¹ì • ì¿ í‚¤ ê°’ì´ ì¡´ì¬í•˜ë©´ í•´ë‹¹ ê°’ì— í•´ë‹¹í•˜ëŠ” ë¼ìš°íŒ… ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë³€ê²½
2. ì¿ í‚¤ê°€ ì—†ë‹¤ë©´ req.header accept-languageë¡œ ì„¤ì •ëœ ê°’ì´ ê°œë°œìê°€ ì„¤ì •í•œ ì–¸ì–´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¡´ì¬í•œë‹¤ë©´ ë¼ìš°íŒ… ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë³€ê²½
3. ëª¨ë‘ í•´ë‹¹í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ê°œë°œìê°€ ì„¤ì •í•œ fallback ì–¸ì–´ë¡œ ë¼ìš°íŒ… ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë³€ê²½
4. ìœ„ ì„¸ê°€ì§€ì— ì ˆì°¨ë¥¼ ë§ˆì¹œ language ê°’ì„ ì¿ í‚¤ì— ì €ì¥
5. ì–¸ì–´ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì„¸ê·¸ë¨¼íŠ¸ ê°’ìœ¼ë¡œ ì ‘ê·¼ì‹œ language ê°’ì„ ì²«ë²ˆì§¸ ì„¸ê·¸ë¨¼íŠ¸ì— ì„¸íŒ…

ìœ„ì™€ ê°™ì€ middleware ì„¤ì •ì‹œ ê°œë°œìëŠ” a íƒœê·¸ ë˜ëŠ” Link(next) íƒœê·¸ ê·¸ë¦¬ê³  router ì‚¬ìš©ì‹œ pathnameì„ ì¼ê´€ì„±ìˆê²Œ ì‘ì—…í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

1. '/' ê²½ë¡œë¡œ ì ‘ê·¼ > fallback ì–¸ì–´ redirect ì •ìƒ ì‘ë™ `(ì˜ˆ: '/' -> '/en')`
2. ë£¨íŠ¸ ê²½ë¡œ('/en') > ì–¸ì–´ë³€ê²½ ì •ìƒ ì‘ë™ `(ì˜ˆ: '/en' -> '/th')`
3. ë£¨íŠ¸ ê²½ë¡œ > about í˜ì´ì§€ ì´ë™ ì •ìƒ ì‘ë™ `(ì˜ˆ: '/th' > '/th/about')`
4. about í˜ì´ì§€ > ì–¸ì–´ ë³€ê²½ > ë³€ê²½ëœ ì–¸ì–´ì˜ ë£¨íŠ¸ ì´ë™ ì •ìƒ ì‘ë™ `(ì˜ˆ: /{ë³€ê²½ ì–¸ì–´})`
5. ë£¨íŠ¸ > about í˜ì´ì§€ ì´ë™ _**ì¿ í‚¤ëŠ” ì •ìƒ ì‘ë™, routing ì˜¤ì‘ë™**_

![i18n_language_selector_trouble_3](./images/i18n_language_selector_trouble_3.gif)

### ì›ì¸ íŒŒì•…

ì›ì¸ì€ ë‹¤ë¦„ ì•„ë‹Œ NextJS ìºì‹±ì´ ì›ì¸ì´ì˜€ë‹¤.

í˜„ì¬ ë™ì‘ì—ì„œëŠ” ì–¸ì–´ ì„¤ì • ë³€ê²½ì‹œ next/navigationì˜ `router.push`ë¥¼ í†µí•´ ë¼ìš°íŒ…ì„ ë³€ê²½í•´ì¤¬ë‹¤.

nextì˜ ì•± ë¼ìš°í„°ëŠ” ë¼ìš°íŒ… íƒìƒ‰ì— ëŒ€í•´ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

- ì„œë²„ - ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ë³„ë¡œ ìë™ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œê°€ ë¶„í• ëœë‹¤.
- í´ë¼ì´ì–¸íŠ¸ - Next.jsëŠ” ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ë¯¸ë¦¬ ê°€ì ¸ì˜¤ê³  ìºì‹œí•œë‹¤.

ì´ë ‡ê²Œ í•˜ëŠ” ì´ìœ ëŠ” ì‚¬ìš©ìê°€ ìƒˆ ê²½ë¡œë¡œ ì´ë™í•  ë•Œ ë¸Œë¼ìš°ì €ê°€ í˜ì´ì§€ë¥¼ ë‹¤ì‹œ ë¡œë“œí•˜ì§€ ì•Šê³  ë³€ê²½ëœ ê²½ë¡œ ì„¸ê·¸ë¨¼íŠ¸ë§Œ ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ê³¼ ì„±ëŠ¥ì„ ê°œì„ í•˜ê¸° ìœ„í•´ì„œë¼ê³  í•œë‹¤.
[ì°¸ê³ ](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#how-routing-and-navigation-works)

### í•´ê²° ë°©ì•ˆ

ì–¸ì–´ ë³€ê²½ì‹œ ë£¨íŠ¸ ê²½ë¡œë¡œ ë¼ìš°íŒ… ì²˜ë¦¬ë¥¼ í•´ì£¼ê³  ìˆë‹¤.

í˜„ì¬ ë¼ìš°íŒ… ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ìœ ì§€í•  í•„ìš”ê°€ ì—†ë‹¤ë©´, `window.location.href`ë¥¼ ë³€ê²½í•´ì„œ ë¸Œë¼ìš°ì € ì£¼ì†Œ ê°’ì„ ë³€ê²½í•´ì„œ í˜ì´ì§€ë¥¼ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë¡œë“œí•´ë„ ë  ê²ƒ ê°™ë‹¤.

ê°œë°œìë„êµ¬ > ë„¤íŠ¸ì›Œí¬ íƒ­ì„ í†µí•´ ì›ì¸ì´ ë§ëŠ”ì§€ í™•ì¸í•´ë³´ì.

- `router.push`ë¥¼ í†µí•´ ë¼ìš°íŒ… í–ˆì„ ë•Œ

![i18n_language_selector_trouble_4](./images/i18n_language_selector_trouble_4.gif)

- `window.location.href`ë¥¼ í†µí•´ ë¼ìš°íŒ… í–ˆì„ ë•Œ

![i18n_language_selector_trouble_5](./images/i18n_language_selector_trouble_5.gif)

### (ë³€ê²½) next-i18next>next-intl

ì´ìœ 
ìš”êµ¬ ì‚¬í•­ì˜ ë³€ë™

ë³€ê²½ì‚¬í•­

- (ê¸°ì¡´) '/' ì ‘ê·¼ì‹œ fallback languageì— ë§ì¶° ë¼ìš°íŒ… ë³€ê²½
- (ë³€ê²½) '/' ì ‘ê·¼ì‹œ ë¼ìš°íŒ… ë³€ê²½ì—†ì´ fallback languageê°€ ì ìš©ë˜ì•¼í•¨

í”„ë¡œì íŠ¸ êµ¬ì¡°

ğŸ“¦root<br />
â”£ ğŸ“‚app<br />
â”ƒ â”— ğŸ“‚[language]<br />
â”ƒ â”ƒ â”£ ğŸ“œpage.tsx<br />
â”ƒ â”ƒ â”— ğŸ“œlayout.tsx

next íŠ¹ì„±ìƒ dynamic ë¼ìš°íŒ…ìœ¼ë¡œ ë¬¶ì—¬ìˆì–´ fallback language ì „ìš©ìœ¼ë¡œ ë”°ë¡œ rootì˜ pageë¥¼ ë§Œë“¤ì–´ ì ìš©ì‹œí‚¬ ìˆ˜ ìˆì§€ë§Œ ì´ë ‡ê²Œ ëœë‹¤ë©´ ê°™ì€ ë‚´ìš©ì˜ 2ë²Œì˜ íŒŒì¼ì´ ìƒê²¨ë‚˜ê²Œ ëœë‹¤.

ì´ëŸ° ê²½ìš° ì‰½ê²Œ í•´ê²°í•´ì¤„ ìˆ˜ ìˆëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ì œê³µí•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ next-intlì„ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤.([ì°¸ê³ ](https://next-intl-docs.vercel.app/docs/routing/middleware))

### next-intl

- 2ê°€ì§€ ë¯¸ë“¤ì›¨ì–´ ì „ëµ ì¡´ì¬
  - prefix ê¸°ë°˜ì˜ ë¼ìš°íŒ…
  - ë„ë©”ì¸ ê¸°ë°˜ì˜ ë¼ìš°íŒ…

#### prefix ê¸°ë°˜ì˜ ë¼ìš°íŒ…

- [language] í´ë” ì•ˆì— ì¤‘ì²©ë˜ì–´ ìˆì§€ë§Œ ê¸°ë³¸ ë¡œì¼€ì¼ì— ëŒ€í•œ ìš”ì²­ì€ ì ‘ë‘ì‚¬ ì—†ì´ ë‚´ë¶€ì ìœ¼ë¡œ ì‘ì„±ë¨
  - / > /en
  - /about > /en/about
  - /de/about > /de/about
- accept-language í—¤ë” ê¸°ë°˜ locale ê°ì§€ > ì¿ í‚¤ì— í•´ë‹¹ locale ì €ì¥ > í•´ë‹¹ localeì— ë§ê²Œ redirection

#### ë„ë©”ì¸ ê¸°ë°˜ì˜ ë¼ìš°íŒ…

- ìš”ì²­ì´ ê°€ëŠ¥í•œ ë„ë©”ì¸ê³¼ ì¼ì¹˜ì‹œí‚¤ê¸° ìœ„í•´ hostëŠ” x-forwarded-host í—¤ë”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°ì§€í•˜ë©° hostë¡œ ëŒ€ì²´ëœë‹¤.
- ë¡œì¼€ì¼ì€ ê²½ë¡œì— ë¡œì¼€ì¼ ì ‘ë‘ì–´ ê°ì§€ > ìš”ì²­ì— í˜¸ìŠ¤íŠ¸ê°€ domainsì— êµ¬ì„±ë˜ì–´ ìˆë‹¤ë©´ í•´ë‹¹ ë„ë©”ì¸ì˜ defaultLocaleì´ ì‚¬ìš© > ì—†ë‹¤ë©´ ì ‘ë‘ì‚¬ ê¸°ë°˜ ë¼ìš°íŒ…ì˜ ë¡œì¼€ì¼ ê°ì§€ê°€ ì ìš©

ìš”êµ¬ì‚¬í•­ì— ë§ì¶° next-intlì˜ **prefix ê¸°ë°˜ì˜ ë¼ìš°íŒ… ì „ëµ**ì„ í™œìš©í–ˆë‹¤.

#### next-intl ì„¤ì •

**ì„œë²„ ì»´í¬ë„ŒíŠ¸ ì„¤ì •**

```js title="next.config.js"
const withNextIntl = require('next-intl/plugin')('./src/i18n.ts');
```

```ts title="i18n.ts"
import { getRequestConfig } from 'next-intl/server';

export default getRequestConfig(async ({ locale }) => ({
  messages: (await import(`./i18n/locales/${locale}.json`)).default,
}));
```

**ë¯¸ë“¤ì›¨ì–´ ì„¤ì •**

```ts title="i18n/config.ts"
export const defaultLocale = 'en';

export const locales = [defaultLocale, 'pt', 'zh-hans', 'zh-hant', 'th'];
```

```ts title="middleware.ts"
import createMiddleware from 'next-intl/middleware';
import { defaultLocale, locales } from './i18n/config';

export const config = {
  matcher: [
    '/((?!api|_next/static|_next/image|images|fonts|videos|assets|favicon.ico|robots|sitemap|sw.js).*)',
  ],
};

export default createMiddleware({
  locales,
  defaultLocale,
  localeDetection: false,
});
```

**ê²°ê³¼ í™”ë©´**

![i18n_language_selector_trouble_6](./images/i18n_language_selector_trouble_6.webp)
